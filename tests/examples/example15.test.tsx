import { expect } from "bun:test"
import { test } from "bun:test"
import { SchematicTracePipelineSolver, type InputProblem } from "lib/index"
import "tests/fixtures/matcher"

const inputProblem: InputProblem = {
  chips: [
    {
      chipId: "schematic_component_0",
      center: {
        x: 0.79,
        y: 0,
      },
      width: 3.8,
      height: 8.400000000000004,
      pins: [
        {
          pinId: "U3.1",
          x: -1.1099999999999999,
          y: 1.2000000000000015,
        },
        {
          pinId: "U3.2",
          x: -1.1099999999999999,
          y: -1.8000000000000007,
        },
        {
          pinId: "U3.3",
          x: -1.1099999999999999,
          y: -2.000000000000001,
        },
        {
          pinId: "U3.4",
          x: -1.1099999999999999,
          y: -2.200000000000001,
        },
        {
          pinId: "U3.5",
          x: -1.1099999999999999,
          y: -2.4000000000000012,
        },
        {
          pinId: "U3.6",
          x: -1.1099999999999999,
          y: -2.6000000000000014,
        },
        {
          pinId: "U3.7",
          x: -1.1099999999999999,
          y: -2.8000000000000016,
        },
        {
          pinId: "U3.8",
          x: -1.1099999999999999,
          y: -3.0000000000000018,
        },
        {
          pinId: "U3.9",
          x: -1.1099999999999999,
          y: -3.200000000000002,
        },
        {
          pinId: "U3.10",
          x: -1.1099999999999999,
          y: 1.0000000000000013,
        },
        {
          pinId: "U3.11",
          x: -1.1099999999999999,
          y: -3.400000000000002,
        },
        {
          pinId: "U3.12",
          x: -1.1099999999999999,
          y: -3.6000000000000023,
        },
        {
          pinId: "U3.13",
          x: -1.1099999999999999,
          y: -3.8000000000000025,
        },
        {
          pinId: "U3.14",
          x: -1.1099999999999999,
          y: -4.000000000000002,
        },
        {
          pinId: "U3.15",
          x: 2.69,
          y: -0.5000000000000009,
        },
        {
          pinId: "U3.16",
          x: 2.69,
          y: -0.7000000000000011,
        },
        {
          pinId: "U3.17",
          x: 2.69,
          y: -0.9000000000000012,
        },
        {
          pinId: "U3.18",
          x: 2.69,
          y: -1.1000000000000014,
        },
        {
          pinId: "U3.19",
          x: 2.69,
          y: -1.3000000000000014,
        },
        {
          pinId: "U3.20",
          x: 2.69,
          y: -1.9000000000000015,
        },
        {
          pinId: "U3.21",
          x: 2.69,
          y: -2.1000000000000014,
        },
        {
          pinId: "U3.22",
          x: -1.1099999999999999,
          y: 0.8000000000000012,
        },
        {
          pinId: "U3.23",
          x: -1.1099999999999999,
          y: 2.8000000000000016,
        },
        {
          pinId: "U3.24",
          x: 2.69,
          y: -2.7000000000000015,
        },
        {
          pinId: "U3.25",
          x: 2.69,
          y: -2.9000000000000012,
        },
        {
          pinId: "U3.26",
          x: 2.69,
          y: -3.1000000000000014,
        },
        {
          pinId: "U3.27",
          x: 2.69,
          y: 0.0999999999999992,
        },
        {
          pinId: "U3.28",
          x: 2.69,
          y: 0.2999999999999994,
        },
        {
          pinId: "U3.29",
          x: 2.69,
          y: 0.49999999999999956,
        },
        {
          pinId: "U3.30",
          x: 2.69,
          y: 0.6999999999999997,
        },
        {
          pinId: "U3.31",
          x: 2.69,
          y: 0.8999999999999995,
        },
        {
          pinId: "U3.32",
          x: 2.69,
          y: 1.0999999999999996,
        },
        {
          pinId: "U3.33",
          x: -1.1099999999999999,
          y: 0.600000000000001,
        },
        {
          pinId: "U3.34",
          x: 2.69,
          y: 1.2999999999999998,
        },
        {
          pinId: "U3.35",
          x: 2.69,
          y: 1.5,
        },
        {
          pinId: "U3.36",
          x: 2.69,
          y: 1.7000000000000002,
        },
        {
          pinId: "U3.37",
          x: 2.69,
          y: 1.9000000000000004,
        },
        {
          pinId: "U3.38",
          x: 2.69,
          y: 2.500000000000001,
        },
        {
          pinId: "U3.39",
          x: 2.69,
          y: 2.700000000000001,
        },
        {
          pinId: "U3.40",
          x: 2.69,
          y: 2.9000000000000012,
        },
        {
          pinId: "U3.41",
          x: 2.69,
          y: 3.1000000000000014,
        },
        {
          pinId: "U3.42",
          x: -1.1099999999999999,
          y: 0.4000000000000008,
        },
        {
          pinId: "U3.43",
          x: -1.1099999999999999,
          y: -1.6000000000000005,
        },
        {
          pinId: "U3.44",
          x: -1.1099999999999999,
          y: 2.0000000000000018,
        },
        {
          pinId: "U3.45",
          x: -1.1099999999999999,
          y: 1.8000000000000016,
        },
        {
          pinId: "U3.46",
          x: -1.1099999999999999,
          y: -1.4000000000000004,
        },
        {
          pinId: "U3.47",
          x: -1.1099999999999999,
          y: -1.2000000000000002,
        },
        {
          pinId: "U3.48",
          x: -1.1099999999999999,
          y: -1,
        },
        {
          pinId: "U3.49",
          x: -1.1099999999999999,
          y: 0.20000000000000062,
        },
        {
          pinId: "U3.50",
          x: -1.1099999999999999,
          y: 2.600000000000002,
        },
        {
          pinId: "U3.51",
          x: -1.1099999999999999,
          y: 3.0000000000000018,
        },
        {
          pinId: "U3.52",
          x: -1.1099999999999999,
          y: 3.200000000000002,
        },
        {
          pinId: "U3.53",
          x: -1.1099999999999999,
          y: 3.4000000000000017,
        },
        {
          pinId: "U3.54",
          x: -1.1099999999999999,
          y: 3.600000000000002,
        },
        {
          pinId: "U3.55",
          x: -1.1099999999999999,
          y: 3.8000000000000016,
        },
        {
          pinId: "U3.56",
          x: -1.1099999999999999,
          y: 4.000000000000002,
        },
        {
          pinId: "U3.57",
          x: -1.1099999999999999,
          y: -0.39999999999999947,
        },
      ],
    },
    {
      chipId: "schematic_component_1",
      center: {
        x: -1.5675,
        y: 5.955000000000002,
      },
      width: 0.53,
      height: 1.0999999999999996,
      pins: [
        {
          pinId: "C12.1",
          x: -1.5675,
          y: 6.505000000000002,
        },
        {
          pinId: "C12.2",
          x: -1.5675,
          y: 5.405000000000002,
        },
      ],
    },
    {
      chipId: "schematic_component_2",
      center: {
        x: -0.6374999999999998,
        y: 5.955000000000002,
      },
      width: 0.53,
      height: 1.0999999999999996,
      pins: [
        {
          pinId: "C14.1",
          x: -0.6374999999999998,
          y: 6.505000000000002,
        },
        {
          pinId: "C14.2",
          x: -0.6374999999999998,
          y: 5.405000000000002,
        },
      ],
    },
    {
      chipId: "schematic_component_3",
      center: {
        x: -2.4975,
        y: 5.955000000000002,
      },
      width: 0.53,
      height: 1.0999999999999996,
      pins: [
        {
          pinId: "C8.1",
          x: -2.4975,
          y: 6.505000000000002,
        },
        {
          pinId: "C8.2",
          x: -2.4975,
          y: 5.405000000000002,
        },
      ],
    },
    {
      chipId: "schematic_component_4",
      center: {
        x: 0.2925000000000004,
        y: 5.955000000000002,
      },
      width: 0.53,
      height: 1.0999999999999996,
      pins: [
        {
          pinId: "C13.1",
          x: 0.29250000000000037,
          y: 6.505000000000002,
        },
        {
          pinId: "C13.2",
          x: 0.2925000000000005,
          y: 5.405000000000002,
        },
      ],
    },
    {
      chipId: "schematic_component_5",
      center: {
        x: 1.2225000000000006,
        y: 5.955000000000002,
      },
      width: 0.53,
      height: 1.0999999999999996,
      pins: [
        {
          pinId: "C15.1",
          x: 1.2225000000000006,
          y: 6.505000000000002,
        },
        {
          pinId: "C15.2",
          x: 1.2225000000000006,
          y: 5.405000000000002,
        },
      ],
    },
    {
      chipId: "schematic_component_6",
      center: {
        x: 2.1525000000000007,
        y: 5.955000000000002,
      },
      width: 0.53,
      height: 1.0999999999999996,
      pins: [
        {
          pinId: "C19.1",
          x: 2.1525000000000007,
          y: 6.505000000000002,
        },
        {
          pinId: "C19.2",
          x: 2.1525000000000007,
          y: 5.405000000000002,
        },
      ],
    },
    {
      chipId: "schematic_component_7",
      center: {
        x: -4.6850000000000005,
        y: 3.218333333333335,
      },
      width: 0.53,
      height: 1.1000000000000005,
      pins: [
        {
          pinId: "C18.1",
          x: -4.6850000000000005,
          y: 3.7683333333333353,
        },
        {
          pinId: "C18.2",
          x: -4.6850000000000005,
          y: 2.668333333333335,
        },
      ],
    },
    {
      chipId: "schematic_component_8",
      center: {
        x: -3.7550000000000003,
        y: 3.218333333333335,
      },
      width: 0.53,
      height: 1.1000000000000005,
      pins: [
        {
          pinId: "C7.1",
          x: -3.7550000000000003,
          y: 3.7683333333333353,
        },
        {
          pinId: "C7.2",
          x: -3.7550000000000003,
          y: 2.668333333333335,
        },
      ],
    },
    {
      chipId: "schematic_component_9",
      center: {
        x: -6.415,
        y: 3.2183333333333355,
      },
      width: 0.53,
      height: 1.0999999999999996,
      pins: [
        {
          pinId: "C9.1",
          x: -6.415,
          y: 3.7683333333333353,
        },
        {
          pinId: "C9.2",
          x: -6.415,
          y: 2.6683333333333357,
        },
      ],
    },
    {
      chipId: "schematic_component_10",
      center: {
        x: -2.025,
        y: 1.450000000000001,
      },
      width: 0.53,
      height: 1.1,
      pins: [
        {
          pinId: "C10.1",
          x: -2.025,
          y: 2.000000000000001,
        },
        {
          pinId: "C10.2",
          x: -2.025,
          y: 0.900000000000001,
        },
      ],
    },
    {
      chipId: "schematic_component_11",
      center: {
        x: -2.025,
        y: -2.1500000000000004,
      },
      width: 0.53,
      height: 1.1,
      pins: [
        {
          pinId: "C11.1",
          x: -2.025,
          y: -1.6000000000000003,
        },
        {
          pinId: "C11.2",
          x: -2.025,
          y: -2.7,
        },
      ],
    },
  ],
  directConnections: [
    {
      pinIds: ["U3.1", "C12.1"],
      netId: "chip.U3 > port.IOVDD1 to C12.pin1",
    },
    {
      pinIds: ["U3.10", "C14.1"],
      netId: "chip.U3 > port.IOVDD2 to C14.pin1",
    },
    {
      pinIds: ["U3.22", "C8.1"],
      netId: "chip.U3 > port.IOVDD3 to C8.pin1",
    },
    {
      pinIds: ["U3.33", "C13.1"],
      netId: "chip.U3 > port.IOVDD4 to C13.pin1",
    },
    {
      pinIds: ["U3.42", "C15.1"],
      netId: "chip.U3 > port.IOVDD5 to C15.pin1",
    },
    {
      pinIds: ["U3.49", "C19.1"],
      netId: "chip.U3 > port.IOVDD6 to C19.pin1",
    },
    {
      pinIds: ["U3.23", "C18.1"],
      netId: "chip.U3 > port.DVDD1 to C18.1",
    },
    {
      pinIds: ["U3.50", "C7.1"],
      netId: "chip.U3 > port.DVDD2 to C7.1",
    },
    {
      pinIds: ["C10.1", "U3.44"],
      netId: "capacitor.C10 > port.pin1 to U3.VREG_VIN",
    },
    {
      pinIds: ["C11.1", "U3.43"],
      netId: "capacitor.C11 > port.pin1 to U3.ADC_AVDD",
    },
  ],
  netConnections: [
    {
      netId: "V3_3",
      pinIds: [
        "U3.1",
        "U3.10",
        "U3.22",
        "U3.33",
        "U3.42",
        "U3.49",
        "C12.1",
        "C14.1",
        "C8.1",
        "C13.1",
        "C15.1",
        "C19.1",
      ],
    },
    {
      netId: "V1_1",
      pinIds: ["U3.23", "U3.50", "C18.1", "C7.1", "C9.1"],
    },
    {
      netId: "GND",
      pinIds: [
        "C12.2",
        "C14.2",
        "C8.2",
        "C13.2",
        "C15.2",
        "C19.2",
        "C18.2",
        "C7.2",
        "C9.2",
        "C10.2",
        "C11.2",
      ],
    },
  ],
  availableNetLabelOrientations: {
    V3_3: ["y+"],
    V1_1: ["y+"],
    GND: ["y-"],
  },
  maxMspPairDistance: 2.4,
}

test("example15", () => {
  const solver = new SchematicTracePipelineSolver(inputProblem)
  solver.solve()
  expect(solver).toMatchSolverSnapshot(import.meta.path)
})